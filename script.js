var map = L.map('map').setView([35.4478, 139.6425], 10);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

const fishingPorts = [
    { name: "横浜市", lat: 35.45292901969831, lng: 139.64683459620608, data: { 2018: [4680, 780, 28, 2, 4, 24, 42, 193, 149, 470, 131, 30, 15, 14, 96], 
        2017: [4275 , 4017, 951, 393, 2,383, 0,  50, 29 , 41, 121, 158 , 4, 144, 249, 131], 2016: [5,490, 1,180, 447, 3,154, 23, 150, 204, 160, 20, 204, 9, 1, 6, 1, 5] } },
    { name: "横須賀市", lat: 35.23655063958366, lng: 139.72965893993975, data: { 2018: [4486, 289, 52, 207, 280, 575, 359, 193, 514, 153, 22, 68, 27, 19, 43], 
        2017: [6239, 5787, 385, 283, 208, 64, 1937, 791, 658, 0, 166, 45, 961, 90, 81], 2016: [5,374, 224, 35, 139, 47, 106, 173, 39, 61, 126, 0, 4, 47, 3, 8] } },
    { name: "平塚市", lat: 35.313914627822534, lng: 139.3654484947508, data: { 2018: [267, 0, 0, 0, 71, 65, 52, 13, 0, 1, 1, 1, 1, 2, 1], 
        2017: [445, 443, 2, 0, 9, 0, 157, 120, 30, 0, 83, 2, 26, 2, 0], 2016: [398, 0, 0, 0, 0, 129, 68, 2, 0, 0, 0, 0, 24, 0, 0] } },
    { name: "鎌倉市", lat: 35.30768037984602, lng: 139.4921436217783, data: { 2018: [80, 0, 0, 0, 1, 34, 1, 0, 0, 15, 2, 0, 1, 2, 10], 
        2017: [144, 86, 0, 0, 0, 0, 72, 1, 1, 0, 0, 0, 9, 26, 17], 2016: [106, 0, 0, 0, 0, 89, 2, 0, 0, 1, 0, 0, 24, 1, 0] } },
    { name: "藤沢市", lat: 35.30900012598816, lng: 139.48089413089747, data: { 2018: [249, 0, 0, 0, 15, 66, 36, 13, 0, 2, 1, 1, 2, 1, 9], 
        2017: [793, 775, 0, 0, 25, 0, 468, 108, 47, 1, 30, 3, 69, 7, 4], 2016: [980, 1, 0, 0, 0, 739, 78, 0, 0, 0, 0, 0, 61, 0, 0]} },
    { name: "小田原市", lat: 35.24046065237842, lng: 139.1472210991622, data: { 2018: [1071, 4, 0, 0, 92, 77, 270, 46, 0, 196, 12, 16, 6, 2, 35], 
        2017: [1374, 1305, 4, 0, 78, 0, 290, 191, 358, 0, 90, 12, 219, 42, 7], 2016:  [1,261, 6, 3, 0, 0, 158, 102, 34, 334, 15, 2, 0, 27, 6, 0] } },
    { name: "茅ヶ崎市", lat: 35.31625039464315, lng: 139.39755488655678, data: { 2018: [84, 0, 0, 0, 5, 61, 48, 1, 0, 5, 0, 0, 1, 0, 2], 
        2017: [93, 84, 1, 0, 6, 0, 57, 1, 2, 0, 5, 1, 7, 4, 2], 2016: [88, 0, 0, 0, 0, 65, 6, 0, 0, 0, 0, 0, 10, 0, 0] } },
    { name: "逗子市", lat: 35.29683250611918, lng: 139.55711667808177, data: { 2018: [16, 0, 0, 0, 2, 10, 0, 0, 0, 3, 1, 0, 0, 0, 17], 
        2017: [88, 16, 0, 0, 0, 0, 9, 0, 0, 0, 1, 0, 4, 21, 46], 2016: [27, 0, 0, 0, 0, 16, 1, 0, 0, 0, 0, 0, 7, 0, 0] } },
    { name: "三浦市", lat: 35.28722733658609, lng: 139.5680591877518, data: { 2018: [18124, 4875, 0, 9076, 246, 356, 302, 93, 773, 108, 28, 10, 15, 10, 201], 
        2017: [16904, 16479, 5407, 2840, 6099, 0, 478, 414, 331, 0, 204, 21, 910, 123, 198], 2016: [17,223, 5,334, 313, 207, 2,122, 6,553, 1,883, 642, 996, 69, 288, 121] } },
    { name: "葉山町", lat: 35.284696773426745, lng: 139.56751155479355, data: { 2018: [13, 0, 0, 0, 0, 11, 0, 0, 0, 4, 0, 0, 0, 0, 7], 
        2017: [31, 16, 0, 0, 0, 0, 14, 0, 0, 0, 0, 0, 1, 5, 8], 2016: [27, 0, 0, 0, 0, 24, 0, 0, 0, 0, 0, 0, 3, 0, 0] } },
    { name: "大磯町", lat: 35.30586642620377, lng: 139.31838399205844, data: { 2018: [212, 0, 0, 0, 32, 48, 14, 14, 0, 35, 1, 1, 1, 1, 2], 
        2017: [248, 246, 0, 0, 2, 0, 50, 53, 59, 0, 44, 1, 34, 0, 1], 2016: [267, 0, 0, 0, 0, 47, 32, 6, 106, 34, 37, 1, 34, 0, 0] } },
    { name: "二宮町", lat: 35.291685591500794, lng: 139.24511145532477, data: { 2018: [238, 0, 0, 0, 31, 59, 19, 19, 0, 42, 1, 1, 1, 3, 2], 
        2017: [271, 271, 0, 0, 6, 0, 29, 102, 40, 0, 43, 2, 35, 0, 1], 2016: [271, 0, 0, 0, 0, 31, 1, 0, 75, 0, 68, 0, 41, 0, 0] } },
    { name: "真鶴町", lat: 35.154331939234005, lng: 139.1420355091899, data: { 2018: [1007, 3, 0, 0, 52, 313, 110, 121, 0, 47, 21, 8, 21, 3, 4], 
        2017: [1148, 1098, 8, 0, 60, 0, 239, 238, 334, 0, 62, 5, 115, 16, 5], 2016: [1,297, 21, 5, 0, 16, 179, 0, 80, 453, 188, 0, 26, 0, 0] } },
    { name: "湯河原町", lat: 35.15126727013209, lng: 139.1310579602389, data: { 2018: [455, 4, 0, 0, 3, 60, 221, 29, 0, 29, 24, 3, 1, 3, 1], 
        2017: [341, 331, 5, 0, 7, 0, 66, 26, 177, 0, 4, 4, 21, 6, 3], 2016: [178, 4, 2, 3, 0, 17, 4, 1, 33, 3, 69, 3, 33, 0, 0] } }
];

var selectedYear = "2018";

fishingPorts.forEach(function (port) {
    var marker = L.marker([port.lat, port.lng]).addTo(map);
    marker.bindPopup(port.name);

    marker.on('click', function () {
        var data = port.data[selectedYear];
        var labels = ["魚類", "まぐろ類", "かじき類", "かつお類", "さけ・ます類", "いわし類", "あじ類", "ひらめ・かれい類", "たら類", "たい類", "えび類", "かに類", "貝類", "いか類", "海藻類"];

        var ctx = document.getElementById('chart').getContext('2d');
        if (window.myChart) {
            window.myChart.destroy();
        }
        window.myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: `${port.name} (${selectedYear})の漁獲量`,
                    data: data,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    });
});

document.getElementById('year').addEventListener('change', function () {
    selectedYear = this.value;
});